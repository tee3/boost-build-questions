import toolset ;
import feature ;

feature.feature <built_tool> : : dependency free ;

explicit built_tool ;
exe built_tool
  :
     built_tool.c
  ;

explicit cross ;
exe cross
  :
    cross.c
  ;

# this results in the desired behavior.
explicit cross final-c ;
make cross-final-c
  :
    cross
  :
    @built_tool
  :
    <built_tool>.//built_tool/<toolset>clang

    <toolset>darwin-4.2.1
  ;

# this results in the built tool being built with darwin
explicit cross-final-b ;
make cross-final-b
  :
    cross
  :
    @built_tool
  :
    <built_tool>.//built_tool

    <toolset>darwin-4.2.1
  ;

# this results in cross-final-a in the directory for the clang
explicit cross-final-a ;
make cross-final-a
  :
    cross/<toolset>darwin-4.2.1
  :
    @built_tool
  :
    <built_tool>.//built_tool
  ;

toolset.flags built_tool COMMAND <built_tool> ;

rule built_tool ( targets * : source * : properties * )
{
  DEPENDS $(targets) : [ on $(targets) return $(COMMAND) ] ;
}

actions built_tool bind COMMAND
{
  $(COMMAND:E=built_tool) $(>) $(<)
}
